@model ProfileModel
@{
    ViewData["Title"] = "Profile";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Clothing Online Shop | Thương hiệu thời trang G1</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Premium Bootstrap 4 Landing Page Template" />
    <meta name="keywords" content="Appointment, Booking, System, Dashboard, Health" />
    <meta name="author" content="Shreethemes" />
    <meta name="email" content="support@shreethemes.in" />
    <meta name="website" content="https://shreethemes.in" />
    <meta name="Version" content="v1.2.0" />
    <!-- favicon -->
    <link rel="shortcut icon" href="/lib/images/logoClothes.png">
    <!-- Bootstrap -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" type="text/css" />
    <!-- Icons -->
    <link href="/css/materialdesignicons.min.css" rel="stylesheet" type="text/css" />
    <link href="/css/remixicon.css" rel="stylesheet" type="text/css" />
    <link href="https://unicons.iconscout.com/release/v3.0.6/css/line.css" rel="stylesheet">
    <!-- Css -->
    <link href="/css/style.min.css" rel="stylesheet" type="text/css" id="theme-opt" />
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
    <style>
        .toast-top-right {
            top: 90px !important;
            right: 30px;
        }

        .bg-footer {
            background-color: #101019 !important;
        }

        .alert {
            position: fixed;
            top: 90px;
            right: 20px;
            z-index: 100;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

            .alert.show {
                opacity: 1;
            }

        .confirmation-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1050;
            background-color: white;
            padding: 40px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            display: none;
            text-align: center;
        }

            .confirmation-modal h5 {
                margin-top: 0;
                color: #dc3545;
                font-size: 24px;
            }

            .confirmation-modal p {
                margin-bottom: 20px;
                font-size: 18px;
            }

            .confirmation-modal .button-container {
                display: flex;
                justify-content: flex-end;
            }

            .confirmation-modal button {
                margin-left: 10px;
                font-size: 16px;
            }
    </style>
</head>
<body>

    <!-- Loader -->
    <div id="preloader">
        <div id="status">
            <div class="spinner">
                <div class="double-bounce1"></div>
                <div class="double-bounce2"></div>
            </div>
        </div>
    </div>
    <!-- Loader -->
    <!-- Start -->
    <section class="bg-dashboard">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-xl-4 col-lg-4 col-md-5 col-12">
                    <div class="rounded shadow overflow-hidden sticky-bar">
                        <div class="card border-0">
                            <img src="/lib/images/bg/background-thoi-trang-hien-dai-dep_025701441.jpg" style="height: 160px" class="img-fluid" alt="">
                        </div>

                        <div class="text-center avatar-profile margin-nagative mt-n5 position-relative pb-4 border-bottom">
                            <img src="@Url.Content("~/Avatars/" + Model.Avatar)" class="rounded-circle shadow-md avatar avatar-md-md" alt="">
                            <h5 class="mt-3 mb-1">@Model.FullName</h5>
                            <p class="text-muted mb-0">@Model.RoleName?.ToUpper()</p>
                        </div>

                        <div class="list-unstyled p-4 border-bottom">
                            <div class="progress-box mb-4">
                                <h6 class="title">Hoàn thành hồ sơ của bạn</h6>
                                <br>
                                <div class="progress">
                                    <div class="progress-bar position-relative bg-info" style="width:@Model.CompletionPercentage%;">
                                        <div class="progress-value d-block text-muted h6">@Model.CompletionPercentage%</div>
                                    </div>
                                </div>
                            </div><!--end process box-->

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-user align-text-bottom text-info h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Giới tính</h6>
                                <p class="text-muted mb-0 ms-2">@(Model.Gender.HasValue ? (Model.Gender.Value ? "Nam" : "Nữ") : string.Empty)</p>
                            </div>

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-calender align-text-bottom text-info h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Ngày sinh</h6>
                                <p class="text-muted mb-0 ms-2">@(Model.Birthday.HasValue ? Model.Birthday.Value.ToString("dd/MM/yyyy") : string.Empty)</p>
                            </div>

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-book-open align-text-bottom text-info h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Số điện thoại</h6>
                                <p class="text-muted mb-0 ms-2">@Model.PhoneNumber</p>
                            </div>

                            <div class="d-flex align-items-center mt-2">
                                <i class="uil uil-italic align-text-bottom text-info h5 mb-0 me-2"></i>
                                <h6 class="mb-0">Địa chỉ</h6>
                                <p class="text-muted mb-0 ms-2">@Model.Address</p>
                            </div>
                        </div>

                        <ul class="list-unstyled sidebar-nav mb-0 align-items-center mt-2" style="padding-left:13px">
                            <li class="navbar-item"><a href="@Url.Action("Index", "Profile")" class="navbar-link" style="color: #64c2f1 !important"><i class="uil uil-user me-2 d-inline-block"></i> Cài Đặt Hồ Sơ</a></li>
                            <li class="navbar-item"><a href="#" class="navbar-link" style="color:black !important"><i class="uil uil-bill me-2 d-inline-block"></i> Đơn Hàng Của Tôi</a></li>
                            <li class="navbar-item"><a href="/Profile/SendPass?email=@Model.Email" class="navbar-link" style="color:black !important"><i class="uil uil-envelope-redo me-2 d-inline-block"></i> Lấy Lại Mật Khẩu</a></li>
                            <li class="navbar-item"><a href="@Url.Action("Index", "Logout")" class="navbar-link" style="color:black !important"><i class="uil uil-sign-out-alt me-2 d-inline-block"></i> Đăng Xuất</a></li>
                        </ul>

                    </div>
                </div><!--end col-->

                <div class="col-xl-8 col-lg-8 col-md-7 mt-4 pt-2 mt-sm-0 pt-sm-0">
                    <h4 class="mb-0 pb-2" style="text-align:center">Cài Đặt Hồ Sơ</h4>
                    <div class="rounded shadow mt-4">
                        <div class="p-4 border-bottom">
                            <h5 class="mb-0">Thông Tin Cá Nhân :</h5>
                        </div>
                        @using (Html.BeginForm("UpdateProfile", "Profile", FormMethod.Post, new { enctype = "multipart/form-data" }))
                        {
                            @Html.AntiForgeryToken() <!--Gửi yêu cầu đến server từ Form có mã hóa token duy nhất-->
                            <div class="p-4 border-bottom">
                                <div class="row align-items-center">
                                    <div class="col-lg-2 col-md-4">
                                        <img src="@Url.Content("~/Avatars/" + Model.Avatar)" id="uploadedImage" class="avatar avatar-md-md rounded-pill shadow mx-auto d-block" alt="" style="display:none;">
                                    </div><!--end col-->

                                    <div class="col-lg-5 col-md-8 text-center text-md-start mt-4 mt-sm-0">
                                        <h5 class="">Tải lên ảnh của bạn</h5>
                                        <p class="text-muted mb-0">Để có hình ảnh tốt nhất, hãy sử dụng hình ảnh có kích thước tối thiểu 256px x 256px ở định dạng .jpg hoặc .png</p>
                                    </div><!--end col-->

                                    <div class="col-lg-5 col-md-12 text-lg-end text-center mt-4 mt-lg-0">
                                        <input type="file" name="avatarFile" id="uploadImageInput" style="display:none" accept="image/*">
                                        <a href="#" class="btn btn-info" onclick="document.getElementById('uploadImageInput').click()">Tải lên</a>
                                        <a href="#" class="btn btn-soft-info ms-2" onclick="removeImage()">Xóa</a>
                                    </div><!--end col-->
                                @Html.ValidationMessageFor(m => m.Avatar)
                                </div><!--end row-->
                            </div>

                            <div class="p-4">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Họ Và Tên</label>
                                            @Html.TextBoxFor(m => m.FullName, new { @class = "form-control", placeholder="Họ và tên của bạn :"})
                                            @Html.ValidationMessageFor(m => m.FullName)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Email</label>
                                            <input style="pointer-events: none; background-color: #cccccc" readonly name="email" id="email" type="email" class="form-control" placeholder="Địa chỉ email :" value="@Model.Email">
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Ngày Sinh</label>
                                            @Html.TextBoxFor(m => m.Birthday, new { @class = "form-control datepicker", placeholder="Ngày sinh của bạn :", type = "date", id = "dob" })
                                            @Html.ValidationMessageFor(m => m.Birthday)
                                            @if (Model.Birthday.HasValue)
                                            {
                                                <script>
                                                    document.getElementById("dob").value = "@Model.Birthday.Value.ToString("yyyy-MM-dd")";
                                                </script>
                                            }
                                        </div>
                                    </div><!--end col-->


                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Giới Tính</label>
                                            @Html.DropDownListFor(m => m.Gender, new SelectList(new[]
                                        {
                                        new { Text = "Nam", Value = true },
                                        new { Text = "Nữ", Value = false }
                                        }, "Value", "Text"), new { @class = "form-control form-select" })
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Địa Chỉ</label>
                                            @Html.TextAreaFor(m => m.Address, new { @class = "form-control", placeholder="Địa chỉ của bạn :",  rows="3" })
                                            @Html.ValidationMessageFor(m => m.Address)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-md-6">
                                        <div class="mb-3">
                                            <label class="form-label">Số Điện Thoại</label>
                                            @Html.TextBoxFor(m => m.PhoneNumber, new { @class = "form-control", placeholder="Số điện thoại của bạn :" })
                                            @Html.ValidationMessageFor(m => m.PhoneNumber)
                                        </div>
                                    </div><!--end col-->
                                </div>

                                <!--end row-->

                                <div class="row">
                                    <div class="col-sm-12">
                                        <input type="submit" id="submit" name="send" class="btn btn-info" value="Lưu thay đổi">
                                    </div><!--end col-->
                                </div>
                                <!--end row-->
                            </div>
                        }
                    </div>

                    <div class="rounded shadow mt-4">
                        <div class="p-4 border-bottom">
                            <h5 class="mb-0">Thay Đổi Mật Khẩu :</h5>
                        </div>

                        <div class="p-4">
                            @using (Html.BeginForm("UpdatePassword", "Profile", FormMethod.Post))
                            {
                                <div class="row">
                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <label class="form-label">Mật khẩu cũ :</label>
                                            @Html.PasswordFor(m => m.oldPassword, new { @class = "form-control", placeholder="Nhập mật khẩu cũ", required="" })
                                            @Html.ValidationMessageFor(m => m.oldPassword)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <label class="form-label">Mật khẩu mới :</label>
                                            @Html.PasswordFor(m => m.newPassword, new { @class = "form-control", placeholder="Nhập mật khẩu mới", required="" })
                                            @Html.ValidationMessageFor(m => m.newPassword)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-lg-12">
                                        <div class="mb-3">
                                            <label class="form-label">Xác nhận mật khẩu mới :</label>
                                            @Html.PasswordFor(m => m.conFirmPassword, new { @class = "form-control", placeholder="Nhập lại mật khẩu mới", required="" })
                                            @Html.ValidationMessageFor(m => m.conFirmPassword)
                                        </div>
                                    </div><!--end col-->

                                    <div class="col-lg-12 mt-2 mb-0">
                                        <button class="btn btn-info">Lưu mật khẩu</button>
                                    </div><!--end col-->
                                </div>

                                <!--end row-->
                            }
                        </div>
                    </div>


                    <div class="rounded shadow mt-4">
                        <div class="p-4 border-bottom">
                            <h5 class="mb-0 text-danger">Xóa Tài Khoản :</h5>
                        </div>
                        <div class="p-4">
                            <h6 class="mb-0 fw-normal">Bạn có muốn xóa tài khoản này không? Vui lòng nhấn nút "Xóa" bên dưới:</h6>
                            <div class="mt-4">
                                <button class="btn btn-danger" onclick="showConfirmationModal()">Xóa Tài Khoản</button>
                            </div>
                        </div>
                    </div>

                    <div class="confirmation-modal" id="confirmationModal" style="display: none;">
                        <h5>Xóa Tài Khoản</h5>
                        <p>Bạn có chắc chắn muốn xóa tài khoản của mình không?</p>
                        <div>
                            <button class="btn btn-secondary" onclick="hideConfirmationModal()">Hủy</button>
                            <button class="btn btn-danger" onclick="confirmDeleteAccount()">Xóa</button>
                        </div>
                    </div>

                    @section scripts {
                        <script>
                            function showConfirmationModal() {
                                document.getElementById("confirmationModal").style.display = "block";
                            }

                            function hideConfirmationModal() {
                                document.getElementById("confirmationModal").style.display = "none";
                            }

                            function confirmDeleteAccount() {
                                $.ajax({
                                    url: "/Profile/DeleteAccount",
                                    type: "POST"
                                });
                            }
                        </script>
                    }
                    <script>
                        $(document).ready(function () {
                            var message = '@TempData["FailMessage"]';
                            if (message !== '') {
                                // Hiển thị toast
                                toastr.warning(message, '', {
                                    timeOut: 4000,
                                    showMethod: 'slideDown',
                                    hideMethod: 'slideUp'
                                });
                            }
                        });
                    </script>
                    <script>
                        $(document).ready(function () {
                            var message = '@TempData["SuccessMessage"]';
                            if (message !== '') {
                                // Hiển thị toast
                                toastr.success(message, '', {
                                    timeOut: 4000,
                                    showMethod: 'slideDown',
                                    hideMethod: 'slideUp'
                                });
                            }
                        });
                    </script>
                    <script>
                        $(document).ready(function () {
                            var message = '@TempData["SuccessSendPass"]';
                            if (message !== '') {
                                // Hiển thị toast
                                toastr.success(message, '', {
                                    timeOut: 4000,
                                    showMethod: 'slideDown',
                                    hideMethod: 'slideUp'
                                });
                            }
                        });
                    </script>
                    <script>
                        $(document).ready(function () {
                            var message = '@TempData["FailSendPass"]';
                            if (message !== '') {
                                toastr.error(message, '', {
                                    timeOut: 4000,
                                    showMethod: 'slideDown',
                                    hideMethod: 'slideUp'
                                });
                            }
                        });
                    </script>
                </div><!--end col-->
            </div><!--end row-->
        </div><!--end container-->
    </section><!--end section-->
    <!-- End -->
    <!-- Back to top -->
    <a href="#" onclick="topFunction()" id="back-to-top" class="btn btn-icon btn-pills btn-info back-to-top"><i data-feather="arrow-up" class="icons"></i></a>
    <!-- Back to top -->
    <!-- javascript -->
    <script src="../js/bootstrap.bundle.min.js"></script>
    <!-- Icons -->
    <script src="../js/feather.min.js"></script>
    <!-- Main Js -->
    <script src="../js/app.js"></script>
    <script>
        function handleImageUpload() {
            const input = document.getElementById('uploadImageInput');
            const image = document.getElementById('uploadedImage');

            input.addEventListener('change', (event) => {
                const file = event.target.files[0];
                const reader = new FileReader();

                reader.onload = (readerEvent) => {
                    image.src = readerEvent.target.result;
                    image.style.display = 'block';
                };

                if (file) {
                    reader.readAsDataURL(file);
                }
            });
        }

        function removeImage() {
            const input = document.getElementById('uploadImageInput');
            const image = document.getElementById('uploadedImage');

            input.value = '';
            image.src = '@Url.Content("~/Avatars/" + Model.Avatar)';
            image.style.display = 'none'; 
        }


        document.addEventListener('DOMContentLoaded', handleImageUpload);

    </script>
</body>
